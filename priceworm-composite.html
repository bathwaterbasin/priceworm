<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Sentiment Indicator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .tab-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .sentiment-excellent { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .sentiment-good { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .sentiment-neutral { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .sentiment-poor { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .sentiment-terrible { background: linear-gradient(135deg, #991b1b 0%, #7f1d1d 100%); }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <div class="glass rounded-2xl shadow-2xl overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-purple-600 to-indigo-600 p-6 text-white">
                <h1 class="text-3xl md:text-4xl font-bold mb-2">â‚¿ Bitcoin Sentiment Indicator</h1>
                <p class="text-purple-100">Advanced Multi-Factor Analysis Dashboard</p>
            </div>

            <!-- Tabs -->
            <div class="flex border-b border-gray-200">
                <button id="dashboardTab" class="tab-active flex-1 py-4 px-6 font-semibold transition-all" onclick="switchTab('dashboard')">
                    Dashboard
                </button>
                <button id="learnTab" class="flex-1 py-4 px-6 font-semibold transition-all hover:bg-gray-100" onclick="switchTab('learn')">
                    Learn More
                </button>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboardContent" class="p-6">
                <!-- Composite Score Display -->
                <div id="scoreDisplay" class="sentiment-neutral text-white rounded-xl p-8 mb-6 text-center shadow-lg">
                    <div class="text-lg font-semibold mb-2">Composite Sentiment Score</div>
                    <div class="text-6xl font-bold mb-2"><span id="compositeScore">50.0</span></div>
                    <div class="text-2xl font-semibold"><span id="sentimentLabel">NEUTRAL</span></div>
                </div>

                <!-- Metrics Input Grid -->
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                    <!-- Federal Funds Rate -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            Federal Funds Rate (%)
                            <span class="text-xs font-normal text-gray-500 ml-1">(40% weight)</span>
                        </label>
                        <input type="number" id="fedRate" step="0.25" value="4.50" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                               oninput="updateScore()">
                        <p class="text-xs text-gray-500 mt-1">Lower = Better (0-5.5%)</p>
                    </div>

                    <!-- DXY Index -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            DXY Index
                            <span class="text-xs font-normal text-gray-500 ml-1">(15% weight)</span>
                        </label>
                        <input type="number" id="dxy" step="0.1" value="102.0" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                               oninput="updateScore()">
                        <p class="text-xs text-gray-500 mt-1">Lower = Better (89-115)</p>
                    </div>

                    <!-- High Yield Spreads -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            HY Credit Spreads (bps)
                            <span class="text-xs font-normal text-gray-500 ml-1">(10% weight)</span>
                        </label>
                        <input type="number" id="hySpread" step="10" value="350" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                               oninput="updateScore()">
                        <p class="text-xs text-gray-500 mt-1">Lower = Better (300-1100bps)</p>
                    </div>

                    <!-- 24h Liquidations -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            24h Liquidations
                            <span class="text-xs font-normal text-gray-500 ml-1">(10% weight)</span>
                        </label>
                        <select id="liquidations" 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                onchange="updateScore()">
                            <option value="50">Mixed (50%+ both)</option>
                            <option value="75">>70% Shorts Liquidated</option>
                            <option value="25">>70% Longs Liquidated</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">Shorts liquidated = Bullish</p>
                    </div>

                    <!-- LTH Supply -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            Long-Term Holder Supply (%)
                            <span class="text-xs font-normal text-gray-500 ml-1">(25% weight)</span>
                        </label>
                        <input type="number" id="lthSupply" step="0.1" value="64.0" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                               oninput="updateScore()">
                        <p class="text-xs text-gray-500 mt-1">Lower = Better! (56-67%)</p>
                    </div>

                    <!-- Add to History Button -->
                    <div class="bg-gray-50 p-4 rounded-lg flex items-end">
                        <button onclick="addToHistory()" 
                                class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-2 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition-all shadow-md">
                            Add to History
                        </button>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid lg:grid-cols-2 gap-6 mb-6">
                    <!-- Historical Trend -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">Historical Trend</h3>
                        <div style="position: relative; height: 300px;">
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>

                    <!-- Metric Breakdown -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800">Metric Breakdown</h3>
                        <div style="position: relative; height: 300px;">
                            <canvas id="breakdownChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Daily Chart Section -->
                <div class="bg-gray-50 p-6 rounded-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Bitcoin Price vs Sentiment Score (Historical)</h3>
                        <div class="flex gap-2">
                            <button onclick="loadHistoricalData()" class="bg-green-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-700 transition-all text-sm">
                                Load Historical Data
                            </button>
                            <select id="dateRange" onchange="filterDateRange()" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <option value="all">All Data</option>
                                <option value="2020">2020 (COVID Crash)</option>
                                <option value="2021">2021 (Bull Peak)</option>
                                <option value="2022">2022 (Bear Market)</option>
                                <option value="2024">2024-2025 (Current)</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3 text-sm text-gray-600">
                        <span class="font-semibold">Data Points:</span> <span id="dataPointCount">0</span> | 
                        <span class="font-semibold">Correlation:</span> <span id="correlationValue">N/A</span>
                    </div>
                    <div style="position: relative; height: 400px;">
                        <canvas id="dailyChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Learn More Tab -->
            <div id="learnContent" class="p-6 hidden">
                <div class="prose max-w-none">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800">Understanding the Metrics</h2>

                    <!-- Federal Funds Rate -->
                    <div class="bg-gray-50 p-6 rounded-lg mb-6">
                        <h3 class="text-xl font-bold text-purple-600 mb-3">Federal Funds Rate (40% Weight)</h3>
                        <p class="text-gray-700 mb-3">
                            The Fed Funds Rate is the most influential factor for risk assets. Lower rates make Bitcoin more attractive as traditional savings yield less, while higher rates strengthen the dollar and reduce liquidity.
                        </p>
                        <p class="text-gray-700 mb-3"><strong>Formula:</strong> 100 - (rate Ã— 18.18). Lower rates = Higher scores.</p>
                        <div class="bg-white p-4 rounded mt-3">
                            <p class="font-semibold text-gray-800 mb-2">Historical Examples:</p>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li><strong>March 2020:</strong> Emergency cut to 0-0.25% triggered massive Bitcoin rally from $4,000 to $64,000 by April 2021</li>
                                <li><strong>November 2021:</strong> Still at 0-0.25%, peak liquidity environment coincided with BTC all-time high of $69,000</li>
                                <li><strong>June 2022:</strong> Aggressive hikes to 1.5-1.75% contributed to BTC bottoming at $17,600</li>
                                <li><strong>October 2024:</strong> First cut in cycle to 4.75-5.00% sparked rally from $60,000 to $73,000+</li>
                            </ul>
                        </div>
                    </div>

                    <!-- DXY Index -->
                    <div class="bg-gray-50 p-6 rounded-lg mb-6">
                        <h3 class="text-xl font-bold text-purple-600 mb-3">DXY Dollar Index (15% Weight)</h3>
                        <p class="text-gray-700 mb-3">
                            The DXY measures the US dollar against a basket of currencies. Bitcoin typically has an inverse relationship with dollar strength, as a weaker dollar makes alternative assets more attractive.
                        </p>
                        <p class="text-gray-700 mb-3"><strong>Formula:</strong> 100 - ((DXY - 89) Ã— 3.846). Lower DXY = Higher scores.</p>
                        <div class="bg-white p-4 rounded mt-3">
                            <p class="font-semibold text-gray-800 mb-2">Historical Examples:</p>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li><strong>March 2020:</strong> DXY spiked to 103 during panic, then fell to 89 by January 2021 as BTC surged</li>
                                <li><strong>November 2021:</strong> DXY at 96, relatively weak dollar supported risk-on environment for crypto</li>
                                <li><strong>June 2022:</strong> DXY peaked at 105, strong dollar pressured all risk assets including Bitcoin</li>
                                <li><strong>October 2024:</strong> DXY dropped to 100-102 range, weakening dollar helped fuel the rally</li>
                            </ul>
                        </div>
                    </div>

                    <!-- High Yield Spreads -->
                    <div class="bg-gray-50 p-6 rounded-lg mb-6">
                        <h3 class="text-xl font-bold text-purple-600 mb-3">High Yield Credit Spreads (10% Weight)</h3>
                        <p class="text-gray-700 mb-3">
                            Credit spreads measure the risk premium investors demand for corporate bonds over Treasuries. Tight spreads indicate market confidence and risk appetite, while wide spreads signal fear and reduced liquidity.
                        </p>
                        <p class="text-gray-700 mb-3"><strong>Formula:</strong> 100 - ((spread - 300) Ã— 0.125). Lower spreads = Higher scores.</p>
                        <div class="bg-white p-4 rounded mt-3">
                            <p class="font-semibold text-gray-800 mb-2">Historical Examples:</p>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li><strong>March 2020:</strong> Spreads exploded to 1,100 bps during COVID crash, extreme risk-off mode</li>
                                <li><strong>November 2021:</strong> Spreads compressed to 310 bps, peak market confidence and liquidity</li>
                                <li><strong>June 2022:</strong> Spreads widened to 550 bps amid recession fears and liquidity crisis</li>
                                <li><strong>October 2024:</strong> Spreads at 350-400 bps, healthy risk appetite supporting crypto markets</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 24h Liquidations -->
                    <div class="bg-gray-50 p-6 rounded-lg mb-6">
                        <h3 class="text-xl font-bold text-purple-600 mb-3">24h Liquidations (15% Weight)</h3>
                        <p class="text-gray-700 mb-3">
                            Liquidation patterns reveal market positioning and potential for continued moves. Heavy short liquidations (longs winning) suggest bullish momentum, while heavy long liquidations signal bearish pressure.
                        </p>
                        <p class="text-gray-700 mb-3"><strong>Scoring:</strong> 75 if >70% shorts liquidated (bullish), 25 if >70% longs liquidated (bearish), 50 if mixed</p>
                        <div class="bg-white p-4 rounded mt-3">
                            <p class="font-semibold text-gray-800 mb-2">Historical Examples:</p>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li><strong>March 2020:</strong> $1 billion in long liquidations on March 12-13, capitulation bottom signal</li>
                                <li><strong>November 2021:</strong> Heavy short squeezes throughout Q4 2021, 80%+ short liquidations fueling rally</li>
                                <li><strong>June 2022:</strong> Cascading long liquidations, $400M+ in 24h, marking bear market bottom</li>
                                <li><strong>October 2024:</strong> 70%+ short liquidations as market broke out, shorts caught offside</li>
                            </ul>
                        </div>
                    </div>

                    <!-- LTH Supply -->
                    <div class="bg-gray-50 p-6 rounded-lg mb-6">
                        <h3 class="text-xl font-bold text-purple-600 mb-3">Long-Term Holder Supply % (25% Weight)</h3>
                        <p class="text-gray-700 mb-3">
                            The percentage of Bitcoin held by long-term holders (155+ days) indicates market phase. LOWER LTH supply means distribution is complete and weak hands are out - bullish for rallies. HIGHER LTH means accumulation/distribution phase - often precedes consolidation or tops.
                        </p>
                        <p class="text-gray-700 mb-3"><strong>Formula:</strong> (67 - LTH%) Ã— 9.09. LOWER LTH = Higher scores (contrarian indicator).</p>
                        <div class="bg-white p-4 rounded mt-3">
                            <p class="font-semibold text-gray-800 mb-2">Historical Examples:</p>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li><strong>March 2020:</strong> LTH at 62%, high accumulation during crash = low score (bearish short-term)</li>
                                <li><strong>November 2021:</strong> LTH dropped to 56%, distribution complete = high score (rally ready at top)</li>
                                <li><strong>June 2022:</strong> LTH rose to 65%, accumulation phase = low score (bottom forming)</li>
                                <li><strong>October 2024:</strong> LTH at 64-65%, still accumulating = moderate score</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Composite Score Interpretation -->
                    <div class="bg-gradient-to-r from-purple-600 to-indigo-600 p-6 rounded-lg text-white">
                        <h3 class="text-xl font-bold mb-3">Composite Score Interpretation</h3>
                        <div class="space-y-2">
                            <p><strong>80-100 (Excellent):</strong> Highly favorable macro conditions, strong bullish setup</p>
                            <p><strong>60-79 (Good):</strong> Positive environment, favorable for accumulation and holding</p>
                            <p><strong>40-59 (Neutral):</strong> Mixed signals, cautious approach recommended</p>
                            <p><strong>20-39 (Poor):</strong> Challenging conditions, risk-off environment</p>
                            <p><strong>0-19 (Terrible):</strong> Severely negative macro, high risk of further downside</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var historyData = [{ timestamp: new Date().toISOString(), score: 50.0 }];
        var dailyData = [];
        var allHistoricalData = [];
        var trendChart, breakdownChart, dailyChart;

        var historicalDataset = [
            { date: '2020-03-01', btcPrice: 8500, fedRate: 1.58, dxy: 97.4, hySpread: 380, liq: 50, lth: 61 },
            { date: '2020-03-12', btcPrice: 4800, fedRate: 1.25, dxy: 99.5, hySpread: 900, liq: 25, lth: 62 },
            { date: '2020-03-20', btcPrice: 6200, fedRate: 0.25, dxy: 102.8, hySpread: 1100, liq: 50, lth: 62.5 },
            { date: '2020-04-01', btcPrice: 6400, fedRate: 0.25, dxy: 100.2, hySpread: 850, liq: 50, lth: 63 },
            { date: '2020-05-01', btcPrice: 8800, fedRate: 0.25, dxy: 99.5, hySpread: 720, liq: 75, lth: 63 },
            { date: '2020-06-01', btcPrice: 9500, fedRate: 0.25, dxy: 97.8, hySpread: 610, liq: 75, lth: 62.5 },
            { date: '2020-07-01', btcPrice: 9100, fedRate: 0.25, dxy: 97.2, hySpread: 550, liq: 50, lth: 62 },
            { date: '2020-08-01', btcPrice: 11400, fedRate: 0.25, dxy: 93.5, hySpread: 490, liq: 75, lth: 61.5 },
            { date: '2020-09-01', btcPrice: 10800, fedRate: 0.25, dxy: 92.8, hySpread: 520, liq: 50, lth: 61 },
            { date: '2020-10-01', btcPrice: 10600, fedRate: 0.25, dxy: 93.9, hySpread: 480, liq: 50, lth: 60.5 },
            { date: '2020-11-01', btcPrice: 13700, fedRate: 0.25, dxy: 92.2, hySpread: 410, liq: 75, lth: 60 },
            { date: '2020-12-01', btcPrice: 18800, fedRate: 0.25, dxy: 90.8, hySpread: 360, liq: 75, lth: 59 },
            { date: '2021-01-01', btcPrice: 29000, fedRate: 0.25, dxy: 89.9, hySpread: 340, liq: 75, lth: 58 },
            { date: '2021-02-01', btcPrice: 33500, fedRate: 0.25, dxy: 90.7, hySpread: 320, liq: 75, lth: 57.5 },
            { date: '2021-03-01', btcPrice: 58800, fedRate: 0.25, dxy: 92.8, hySpread: 310, liq: 75, lth: 57 },
            { date: '2021-04-01', btcPrice: 59000, fedRate: 0.25, dxy: 91.2, hySpread: 305, liq: 75, lth: 56.5 },
            { date: '2021-05-01', btcPrice: 37300, fedRate: 0.25, dxy: 90.8, hySpread: 330, liq: 25, lth: 57 },
            { date: '2021-06-01', btcPrice: 35000, fedRate: 0.25, dxy: 91.9, hySpread: 320, liq: 50, lth: 58 },
            { date: '2021-07-01', btcPrice: 33600, fedRate: 0.25, dxy: 92.4, hySpread: 310, liq: 50, lth: 59 },
            { date: '2021-08-01', btcPrice: 41500, fedRate: 0.25, dxy: 92.7, hySpread: 300, liq: 75, lth: 59.5 },
            { date: '2021-09-01', btcPrice: 43800, fedRate: 0.25, dxy: 93.9, hySpread: 310, liq: 50, lth: 58 },
            { date: '2021-10-01', btcPrice: 61800, fedRate: 0.25, dxy: 94.2, hySpread: 305, liq: 75, lth: 57 },
            { date: '2021-11-01', btcPrice: 61000, fedRate: 0.25, dxy: 96.0, hySpread: 310, liq: 75, lth: 56 },
            { date: '2021-11-10', btcPrice: 69000, fedRate: 0.25, dxy: 95.1, hySpread: 305, liq: 75, lth: 56 },
            { date: '2021-12-01', btcPrice: 48900, fedRate: 0.25, dxy: 96.3, hySpread: 330, liq: 25, lth: 56.5 },
            { date: '2022-01-01', btcPrice: 46200, fedRate: 0.25, dxy: 95.6, hySpread: 350, liq: 50, lth: 57 },
            { date: '2022-02-01', btcPrice: 38500, fedRate: 0.25, dxy: 96.0, hySpread: 380, liq: 25, lth: 58 },
            { date: '2022-03-01', btcPrice: 44400, fedRate: 0.50, dxy: 98.3, hySpread: 420, liq: 50, lth: 59 },
            { date: '2022-04-01', btcPrice: 37600, fedRate: 0.50, dxy: 103.0, hySpread: 450, liq: 25, lth: 60 },
            { date: '2022-05-01', btcPrice: 31500, fedRate: 1.00, dxy: 101.7, hySpread: 480, liq: 25, lth: 62 },
            { date: '2022-06-01', btcPrice: 20000, fedRate: 1.75, dxy: 104.5, hySpread: 550, liq: 25, lth: 64 },
            { date: '2022-06-18', btcPrice: 17600, fedRate: 1.75, dxy: 105.2, hySpread: 580, liq: 25, lth: 65 },
            { date: '2022-07-01', btcPrice: 19200, fedRate: 2.50, dxy: 105.8, hySpread: 540, liq: 50, lth: 65.5 },
            { date: '2022-08-01', btcPrice: 23300, fedRate: 2.50, dxy: 106.4, hySpread: 510, liq: 75, lth: 66 },
            { date: '2022-09-01', btcPrice: 20100, fedRate: 3.25, dxy: 109.8, hySpread: 560, liq: 25, lth: 66 },
            { date: '2022-10-01', btcPrice: 19400, fedRate: 3.25, dxy: 112.1, hySpread: 530, liq: 50, lth: 66.5 },
            { date: '2022-11-01', btcPrice: 20500, fedRate: 4.00, dxy: 110.8, hySpread: 510, liq: 50, lth: 67 },
            { date: '2022-12-01', btcPrice: 17100, fedRate: 4.50, dxy: 103.5, hySpread: 490, liq: 50, lth: 67 },
            { date: '2023-01-01', btcPrice: 16600, fedRate: 4.50, dxy: 103.2, hySpread: 470, liq: 50, lth: 67 },
            { date: '2023-02-01', btcPrice: 23100, fedRate: 4.75, dxy: 103.8, hySpread: 450, liq: 75, lth: 66.5 },
            { date: '2023-03-01', btcPrice: 23600, fedRate: 5.00, dxy: 102.9, hySpread: 480, liq: 50, lth: 66 },
            { date: '2023-04-01', btcPrice: 28400, fedRate: 5.00, dxy: 101.8, hySpread: 440, liq: 75, lth: 65.5 },
            { date: '2023-05-01', btcPrice: 27200, fedRate: 5.25, dxy: 101.2, hySpread: 420, liq: 50, lth: 65 },
            { date: '2023-06-01', btcPrice: 30400, fedRate: 5.25, dxy: 102.5, hySpread: 400, liq: 75, lth: 64.5 },
            { date: '2023-07-01', btcPrice: 29200, fedRate: 5.50, dxy: 101.0, hySpread: 390, liq: 50, lth: 64 },
            { date: '2023-08-01', btcPrice: 29100, fedRate: 5.50, dxy: 102.8, hySpread: 410, liq: 50, lth: 64 },
            { date: '2023-09-01', btcPrice: 26900, fedRate: 5.50, dxy: 105.7, hySpread: 440, liq: 25, lth: 64.5 },
            { date: '2023-10-01', btcPrice: 34500, fedRate: 5.50, dxy: 106.2, hySpread: 420, liq: 75, lth: 64 },
            { date: '2023-11-01', btcPrice: 37800, fedRate: 5.50, dxy: 104.0, hySpread: 390, liq: 75, lth: 63.5 },
            { date: '2023-12-01', btcPrice: 44200, fedRate: 5.50, dxy: 101.4, hySpread: 360, liq: 75, lth: 63 },
            { date: '2024-01-01', btcPrice: 42200, fedRate: 5.50, dxy: 102.3, hySpread: 350, liq: 50, lth: 63 },
            { date: '2024-02-01', btcPrice: 51800, fedRate: 5.50, dxy: 104.2, hySpread: 340, liq: 75, lth: 62.5 },
            { date: '2024-03-01', btcPrice: 69300, fedRate: 5.50, dxy: 103.9, hySpread: 330, liq: 75, lth: 62 },
            { date: '2024-04-01', btcPrice: 63500, fedRate: 5.50, dxy: 105.8, hySpread: 350, liq: 50, lth: 62.5 },
            { date: '2024-05-01', btcPrice: 64200, fedRate: 5.50, dxy: 105.2, hySpread: 340, liq: 50, lth: 63 },
            { date: '2024-06-01', btcPrice: 61000, fedRate: 5.50, dxy: 105.5, hySpread: 330, liq: 50, lth: 63.5 },
            { date: '2024-07-01', btcPrice: 66500, fedRate: 5.50, dxy: 104.3, hySpread: 320, liq: 75, lth: 64 },
            { date: '2024-08-01', btcPrice: 61500, fedRate: 5.50, dxy: 103.1, hySpread: 330, liq: 50, lth: 64 },
            { date: '2024-09-01', btcPrice: 63800, fedRate: 5.00, dxy: 100.8, hySpread: 310, liq: 75, lth: 64.5 },
            { date: '2024-10-01', btcPrice: 69000, fedRate: 4.75, dxy: 103.5, hySpread: 300, liq: 75, lth: 65 },
            { date: '2024-11-01', btcPrice: 73500, fedRate: 4.75, dxy: 104.8, hySpread: 310, liq: 75, lth: 64.5 },
            { date: '2024-12-01', btcPrice: 71200, fedRate: 4.50, dxy: 106.2, hySpread: 320, liq: 50, lth: 64 },
            { date: '2025-01-01', btcPrice: 74800, fedRate: 4.50, dxy: 108.5, hySpread: 330, liq: 50, lth: 64 }
        ];

        function calcScore(fedRate, dxy, hySpread, liquidations, lthSupply) {
            // Fed Rate: Lower is better for BTC (more liquidity)
            // Range: 0% = 100 points, 5.5% = 0 points
            var fedScore = Math.max(0, Math.min(100, 100 - (fedRate * 18.18)));
            
            // DXY: Lower is better for BTC (weaker dollar)
            // Range: 89 = 100 points, 115 = 0 points
            var dxyScore = Math.max(0, Math.min(100, 100 - ((dxy - 89) * 3.846)));
            
            // HY Spreads: Lower is better (risk-on environment)
            // Range: 300 = 100 points, 1100 = 0 points
            var hyScore = Math.max(0, Math.min(100, 100 - ((hySpread - 300) * 0.125)));
            
            // Liquidations: 75 = bullish, 25 = bearish, 50 = neutral
            var liqScore = liquidations;
            
            // LTH Supply: INVERTED - Lower is better (distribution complete = rally ready)
            // Range: 67% = 0 points (top/distribution), 56% = 100 points (bottom/ready to rally)
            var lthScore = Math.max(0, Math.min(100, ((67 - lthSupply) * 9.09)));
            
            // Weights: Fed and LTH are most important
            var composite = (fedScore * 0.40) + (lthScore * 0.25) + (dxyScore * 0.15) + (hyScore * 0.10) + (liqScore * 0.10);
            
            return {
                composite: composite,
                breakdown: {
                    fed: fedScore * 0.40,
                    dxy: dxyScore * 0.15,
                    hy: hyScore * 0.10,
                    liq: liqScore * 0.10,
                    lth: lthScore * 0.25
                }
            };
        }

        function initCharts() {
            var trendCtx = document.getElementById('trendChart').getContext('2d');
            trendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: [new Date().toLocaleTimeString()],
                    datasets: [{
                        label: 'Sentiment Score',
                        data: [50.0],
                        borderColor: 'rgb(124, 58, 237)',
                        backgroundColor: 'rgba(124, 58, 237, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: 100, grid: { color: 'rgba(0, 0, 0, 0.05)' } },
                        x: { grid: { display: false } }
                    }
                }
            });

            var breakdownCtx = document.getElementById('breakdownChart').getContext('2d');
            breakdownChart = new Chart(breakdownCtx, {
                type: 'bar',
                data: {
                    labels: ['Fed Rate (40%)', 'DXY (20%)', 'HY Spreads (10%)', 'Liquidations (15%)', 'LTH Supply (15%)'],
                    datasets: [{
                        label: 'Weighted Score',
                        data: [20, 10, 5, 7.5, 7.5],
                        backgroundColor: [
                            'rgba(124, 58, 237, 0.8)',
                            'rgba(99, 102, 241, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(14, 165, 233, 0.8)',
                            'rgba(6, 182, 212, 0.8)'
                        ],
                        borderColor: [
                            'rgb(124, 58, 237)',
                            'rgb(99, 102, 241)',
                            'rgb(59, 130, 246)',
                            'rgb(14, 165, 233)',
                            'rgb(6, 182, 212)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { beginAtZero: true, max: 40, grid: { color: 'rgba(0, 0, 0, 0.05)' } },
                        y: { grid: { display: false } }
                    }
                }
            });

            var dailyCtx = document.getElementById('dailyChart').getContext('2d');
            dailyChart = new Chart(dailyCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'BTC Price',
                        data: [],
                        borderColor: 'rgb(249, 115, 22)',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        tension: 0.4,
                        fill: true,
                        yAxisID: 'y'
                    }, {
                        label: 'Sentiment Score',
                        data: [],
                        borderColor: 'rgb(124, 58, 237)',
                        backgroundColor: 'rgba(124, 58, 237, 0.1)',
                        tension: 0.4,
                        fill: true,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: { legend: { display: true, position: 'top' } },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'BTC Price ($)', color: 'rgb(249, 115, 22)', font: { weight: 'bold' } },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'Sentiment Score', color: 'rgb(124, 58, 237)', font: { weight: 'bold' } },
                            min: 0,
                            max: 100,
                            grid: { drawOnChartArea: false }
                        },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function updateScore() {
            var fedRate = parseFloat(document.getElementById('fedRate').value);
            var dxy = parseFloat(document.getElementById('dxy').value);
            var hySpread = parseFloat(document.getElementById('hySpread').value);
            var liquidations = parseFloat(document.getElementById('liquidations').value);
            var lthSupply = parseFloat(document.getElementById('lthSupply').value);
            var result = calcScore(fedRate, dxy, hySpread, liquidations, lthSupply);
            var score = result.composite;

            document.getElementById('compositeScore').textContent = score.toFixed(1);
            var scoreDisplay = document.getElementById('scoreDisplay');
            var sentimentLabel = document.getElementById('sentimentLabel');
            scoreDisplay.className = 'text-white rounded-xl p-8 mb-6 text-center shadow-lg ';

            if (score >= 80) {
                scoreDisplay.classList.add('sentiment-excellent');
                sentimentLabel.textContent = 'EXCELLENT';
            } else if (score >= 60) {
                scoreDisplay.classList.add('sentiment-good');
                sentimentLabel.textContent = 'GOOD';
            } else if (score >= 40) {
                scoreDisplay.classList.add('sentiment-neutral');
                sentimentLabel.textContent = 'NEUTRAL';
            } else if (score >= 20) {
                scoreDisplay.classList.add('sentiment-poor');
                sentimentLabel.textContent = 'POOR';
            } else {
                scoreDisplay.classList.add('sentiment-terrible');
                sentimentLabel.textContent = 'TERRIBLE';
            }

            breakdownChart.data.datasets[0].data = [
                result.breakdown.fed,
                result.breakdown.dxy,
                result.breakdown.hy,
                result.breakdown.liq,
                result.breakdown.lth
            ];
            breakdownChart.update();
        }

        function addToHistory() {
            var fedRate = parseFloat(document.getElementById('fedRate').value);
            var dxy = parseFloat(document.getElementById('dxy').value);
            var hySpread = parseFloat(document.getElementById('hySpread').value);
            var liquidations = parseFloat(document.getElementById('liquidations').value);
            var lthSupply = parseFloat(document.getElementById('lthSupply').value);
            var result = calcScore(fedRate, dxy, hySpread, liquidations, lthSupply);
            var timestamp = new Date();

            historyData.push({ timestamp: timestamp.toISOString(), score: result.composite });
            if (historyData.length > 20) { historyData.shift(); }

            trendChart.data.labels = historyData.map(function(d) { return new Date(d.timestamp).toLocaleTimeString(); });
            trendChart.data.datasets[0].data = historyData.map(function(d) { return d.score; });
            trendChart.update();
        }

        function loadHistoricalData() {
            allHistoricalData = [];
            for (var i = 0; i < historicalDataset.length; i++) {
                var dataPoint = historicalDataset[i];
                var result = calcScore(dataPoint.fedRate, dataPoint.dxy, dataPoint.hySpread, dataPoint.liq, dataPoint.lth);
                allHistoricalData.push({
                    date: dataPoint.date,
                    btcPrice: dataPoint.btcPrice,
                    sentimentScore: result.composite
                });
            }
            dailyData = allHistoricalData.slice();
            updateDailyChart();
            calculateCorrelation();
        }

        function filterDateRange() {
            var range = document.getElementById('dateRange').value;
            if (range === 'all') {
                dailyData = allHistoricalData.slice();
            } else {
                dailyData = [];
                for (var i = 0; i < allHistoricalData.length; i++) {
                    if (allHistoricalData[i].date.indexOf(range) === 0) {
                        dailyData.push(allHistoricalData[i]);
                    }
                }
            }
            updateDailyChart();
            calculateCorrelation();
        }

        function calculateCorrelation() {
            if (dailyData.length < 2) {
                document.getElementById('correlationValue').textContent = 'N/A';
                return;
            }
            var prices = [];
            var scores = [];
            for (var i = 0; i < dailyData.length; i++) {
                prices.push(dailyData[i].btcPrice);
                scores.push(dailyData[i].sentimentScore);
            }
            var n = prices.length;
            var sumX = 0;
            var sumY = 0;
            var sumXY = 0;
            var sumX2 = 0;
            var sumY2 = 0;
            for (var i = 0; i < n; i++) {
                sumX += prices[i];
                sumY += scores[i];
                sumXY += prices[i] * scores[i];
                sumX2 += prices[i] * prices[i];
                sumY2 += scores[i] * scores[i];
            }
            var correlation = (n * sumXY - sumX * sumY) / Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
            document.getElementById('correlationValue').textContent = correlation.toFixed(3);
        }

        function updateDailyChart() {
            var labels = [];
            var priceData = [];
            var scoreData = [];
            for (var i = 0; i < dailyData.length; i++) {
                var date = new Date(dailyData[i].date);
                labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: '2-digit' }));
                priceData.push(dailyData[i].btcPrice);
                scoreData.push(dailyData[i].sentimentScore);
            }
            dailyChart.data.labels = labels;
            dailyChart.data.datasets[0].data = priceData;
            dailyChart.data.datasets[1].data = scoreData;
            dailyChart.update();
            document.getElementById('dataPointCount').textContent = dailyData.length;
        }

        function switchTab(tab) {
            var dashboardTab = document.getElementById('dashboardTab');
            var learnTab = document.getElementById('learnTab');
            var dashboardContent = document.getElementById('dashboardContent');
            var learnContent = document.getElementById('learnContent');

            if (tab === 'dashboard') {
                dashboardTab.classList.add('tab-active');
                dashboardTab.classList.remove('hover:bg-gray-100');
                learnTab.classList.remove('tab-active');
                learnTab.classList.add('hover:bg-gray-100');
                dashboardContent.classList.remove('hidden');
                learnContent.classList.add('hidden');
            } else {
                learnTab.classList.add('tab-active');
                learnTab.classList.remove('hover:bg-gray-100');
                dashboardTab.classList.remove('tab-active');
                dashboardTab.classList.add('hover:bg-gray-100');
                learnContent.classList.remove('hidden');
                dashboardContent.classList.add('hidden');
            }
        }

        window.addEventListener('load', function() {
            initCharts();
            updateScore();
            loadHistoricalData();
        });
    </script>
</body>
</html>
